<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Laberint Interactiu</title>
<style>
    body {
        text-align: center;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }
    canvas {
        background: white;
        margin-top: 20px;
        border: 2px solid #333;
    }
    button {
        margin-top: 15px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>Laberint Interactiu</h1>
<canvas id="mazeCanvas"></canvas>
<br>
<button onclick="init()">Nou laberint</button>

<script>
const cols = 20;
const rows = 20;
const cellSize = 25;

let grid = [];
let stack = [];
let player = { x: 0, y: 0 };

const canvas = document.getElementById("mazeCanvas");
const ctx = canvas.getContext("2d");
canvas.width = cols * cellSize;
canvas.height = rows * cellSize;

class Cell {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.walls = [true, true, true, true]; // top, right, bottom, left
        this.visited = false;
    }

    draw() {
        const x = this.x * cellSize;
        const y = this.y * cellSize;

        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;

        if (this.walls[0]) drawLine(x, y, x + cellSize, y);
        if (this.walls[1]) drawLine(x + cellSize, y, x + cellSize, y + cellSize);
        if (this.walls[2]) drawLine(x + cellSize, y + cellSize, x, y + cellSize);
        if (this.walls[3]) drawLine(x, y + cellSize, x, y);
    }

    checkNeighbors() {
        const neighbors = [];

        const top = grid[index(this.x, this.y - 1)];
        const right = grid[index(this.x + 1, this.y)];
        const bottom = grid[index(this.x, this.y + 1)];
        const left = grid[index(this.x - 1, this.y)];

        if (top && !top.visited) neighbors.push(top);
        if (right && !right.visited) neighbors.push(right);
        if (bottom && !bottom.visited) neighbors.push(bottom);
        if (left && !left.visited) neighbors.push(left);

        if (neighbors.length > 0) {
            return neighbors[Math.floor(Math.random() * neighbors.length)];
        }
        return undefined;
    }
}

function drawLine(x1, y1, x2, y2) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
}

function index(x, y) {
    if (x < 0 || y < 0 || x >= cols || y >= rows) return -1;
    return x + y * cols;
}

function removeWalls(a, b) {
    const dx = a.x - b.x;
    const dy = a.y - b.y;

    if (dx === 1) { a.walls[3] = false; b.walls[1] = false; }
    if (dx === -1) { a.walls[1] = false; b.walls[3] = false; }
    if (dy === 1) { a.walls[0] = false; b.walls[2] = false; }
    if (dy === -1) { a.walls[2] = false; b.walls[0] = false; }
}

function generateMaze() {
    let current = grid[0];
    current.visited = true;

    while (true) {
        const next = current.checkNeighbors();
        if (next) {
            next.visited = true;
            stack.push(current);
            removeWalls(current, next);
            current = next;
        } else if (stack.length > 0) {
            current = stack.pop();
        } else {
            break;
        }
    }
}

function drawMaze() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    grid.forEach(cell => cell.draw());

    // Dibuixar final
    ctx.fillStyle = "lightgreen";
    ctx.fillRect((cols-1)*cellSize+5, (rows-1)*cellSize+5, cellSize-10, cellSize-10);

    // Dibuixar jugador
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(
        player.x * cellSize + cellSize/2,
        player.y * cellSize + cellSize/2,
        cellSize/4,
        0,
        Math.PI * 2
    );
    ctx.fill();
}

function movePlayer(dx, dy) {
    const current = grid[index(player.x, player.y)];
    const newX = player.x + dx;
    const newY = player.y + dy;
    const next = grid[index(newX, newY)];
    if (!next) return;

    if (dx === 1 && !current.walls[1]) player.x++;
    if (dx === -1 && !current.walls[3]) player.x--;
    if (dy === 1 && !current.walls[2]) player.y++;
    if (dy === -1 && !current.walls[0]) player.y--;

    drawMaze();
    checkWin();
}

function checkWin() {
    if (player.x === cols-1 && player.y === rows-1) {
        setTimeout(() => alert("ðŸŽ‰ Has completat el laberint!"), 100);
    }
}

document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") movePlayer(0, -1);
    if (e.key === "ArrowDown") movePlayer(0, 1);
    if (e.key === "ArrowLeft") movePlayer(-1, 0);
    if (e.key === "ArrowRight") movePlayer(1, 0);
});

function init() {
    grid = [];
    stack = [];
    player = { x: 0, y: 0 };

    for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
            grid.push(new Cell(x, y));
        }
    }

    generateMaze();
    drawMaze();
}

init();
</script>

</body>
</html>
