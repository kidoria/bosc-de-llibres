<!DOCTYPE html>
<html lang="ca">
<head>
  <link rel="icon" type="image/png" href="Favi.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kidora - Laberint</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1 id="titol-conte">RAC√ì DE BITS: Hakejant el futur</h1>
    <p>Ajuda a n'Ona i en Carlea a aconseguir presentar la seva aplicaci√≥ al concurs!</p>
  </header>
<style>
    body {
        text-align: center;
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #ffcc00, #ff5733, #00b3b3, #8e2de2);
        background-size: 300% 300%;
        animation: gradientMove 8s ease infinite;
        color: white;
        margin: 0;
        padding: 0;
    }

    @keyframes gradientMove {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    h1 {
        margin-top: 20px;
    }

    #timer {
        font-size: 20px;
        margin-top: 10px;
        font-weight: bold;
    }

    canvas {
        background: white;
        margin-top: 20px;
        border-radius: 15px;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    button {
        margin: 20px;
        padding: 10px 25px;
        font-size: 16px;
        border: none;
        border-radius: 20px;
        background: ffb347;
        color: white;
        cursor: pointer;
    }

    button:hover {
        opacity: 0.85;
    }
</style>
</head>
<body>

<div id="timer">Temps: 0 s</div>
<canvas id="mazeCanvas"></canvas>
<br>
<button onclick="init()">Nou laberint</button>

<script>
const cols = 20;
const rows = 20;
const cellSize = 25;

let grid = [];
let stack = [];
let player = { x: 0, y: 0 };
let startTime;
let timerInterval;

const canvas = document.getElementById("mazeCanvas");
const ctx = canvas.getContext("2d");
canvas.width = cols * cellSize;
canvas.height = rows * cellSize;

class Cell {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.walls = [true, true, true, true];
        this.visited = false;
    }

    draw() {
        const x = this.x * cellSize;
        const y = this.y * cellSize;

        ctx.strokeStyle = "#00b3b3";
        ctx.lineWidth = 2;

        if (this.walls[0]) drawLine(x, y, x + cellSize, y);
        if (this.walls[1]) drawLine(x + cellSize, y, x + cellSize, y + cellSize);
        if (this.walls[2]) drawLine(x + cellSize, y + cellSize, x, y + cellSize);
        if (this.walls[3]) drawLine(x, y + cellSize, x, y);
    }
}

function drawLine(x1, y1, x2, y2) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
}

function index(x, y) {
    if (x < 0 || y < 0 || x >= cols || y >= rows) return -1;
    return x + y * cols;
}

function removeWalls(a, b) {
    const dx = a.x - b.x;
    const dy = a.y - b.y;

    if (dx === 1) { a.walls[3] = false; b.walls[1] = false; }
    if (dx === -1) { a.walls[1] = false; b.walls[3] = false; }
    if (dy === 1) { a.walls[0] = false; b.walls[2] = false; }
    if (dy === -1) { a.walls[2] = false; b.walls[0] = false; }
}

function generateMaze() {
    let current = grid[0];
    current.visited = true;

    while (true) {
        const neighbors = [];
        const top = grid[index(current.x, current.y - 1)];
        const right = grid[index(current.x + 1, current.y)];
        const bottom = grid[index(current.x, current.y + 1)];
        const left = grid[index(current.x - 1, current.y)];

        if (top && !top.visited) neighbors.push(top);
        if (right && !right.visited) neighbors.push(right);
        if (bottom && !bottom.visited) neighbors.push(bottom);
        if (left && !left.visited) neighbors.push(left);

        if (neighbors.length > 0) {
            const next = neighbors[Math.floor(Math.random() * neighbors.length)];
            next.visited = true;
            stack.push(current);
            removeWalls(current, next);
            current = next;
        } else if (stack.length > 0) {
            current = stack.pop();
        } else {
            break;
        }
    }
}

function drawMaze() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    grid.forEach(cell => cell.draw());

    // Final
    ctx.fillStyle = "#8e2de2";
    ctx.fillRect((cols-1)*cellSize+5, (rows-1)*cellSize+5, cellSize-10, cellSize-10);

    // Jugador
    ctx.fillStyle = "#ff5733";
    ctx.beginPath();
    ctx.arc(
        player.x * cellSize + cellSize/2,
        player.y * cellSize + cellSize/2,
        cellSize/4,
        0,
        Math.PI * 2
    );
    ctx.fill();
}

function movePlayer(dx, dy) {
    const current = grid[index(player.x, player.y)];
    const newX = player.x + dx;
    const newY = player.y + dy;
    const next = grid[index(newX, newY)];
    if (!next) return;

    if (dx === 1 && !current.walls[1]) player.x++;
    if (dx === -1 && !current.walls[3]) player.x--;
    if (dy === 1 && !current.walls[2]) player.y++;
    if (dy === -1 && !current.walls[0]) player.y--;

    drawMaze();
    checkWin();
}

function checkWin() {
    if (player.x === cols-1 && player.y === rows-1) {
        clearInterval(timerInterval);
        const totalTime = Math.floor((Date.now() - startTime)/1000);
        setTimeout(() => alert("üéâ Has completat el laberint en " + totalTime + " segons!"), 100);
    }
}

document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") movePlayer(0, -1);
    if (e.key === "ArrowDown") movePlayer(0, 1);
    if (e.key === "ArrowLeft") movePlayer(-1, 0);
    if (e.key === "ArrowRight") movePlayer(1, 0);
});

function startTimer() {
    startTime = Date.now();
    timerInterval = setInterval(() => {
        const seconds = Math.floor((Date.now() - startTime)/1000);
        document.getElementById("timer").textContent = "Temps: " + seconds + " s";
    }, 1000);
}

function init() {
    grid = [];
    stack = [];
    player = { x: 0, y: 0 };
    clearInterval(timerInterval);
    document.getElementById("timer").textContent = "Temps: 0 s";

    for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
            grid.push(new Cell(x, y));
        }
    }

    generateMaze();
    drawMaze();
    startTimer();
}

init();
</script>

</body>
</html>
