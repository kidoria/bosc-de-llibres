<!DOCTYPE html>
<html lang="ca">
<head>
  <link rel="icon" type="image/png" href="Favi.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rac√≥ de bits - Kid√≤ria</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>

  header {
  text-align: center;
  padding: 2rem;
  background-color: #4BC6B9;
  color: #FFFFFF;
  }
  
  body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom, #87ceeb, #f0f8ff);
    overflow: hidden;
  }


  #score {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 900;
    font-size: 28px;
    color: #3f51b5;
  }

  #highScore {
    position: absolute;
    top: 60px;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 700;
    font-size: 20px;
    color: #ff9800;
  }

  #newRecord {
    position: absolute;
    top: 95px;
    left: 50%;
    transform: translateX(-50%);
    font-weight: bold;
    font-size: 18px;
    color: #4caf50;
    display: none;
    animation: fadeIn 0.5s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  canvas {
    display: block;
    margin: 120px auto;
    background: #a3d5ff;
    border-radius: 15px;
    box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    border: 3px solid #4a148c;
  }

  #btnReiniciar {
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 12px 25px;
    font-size: 20px;
    font-weight: bold;
    border: none;
    border-radius: 10px;
    background-color: #4a148c;
    color: white;
    cursor: pointer;
    display: none;
  }

  #btnReiniciar:hover {
    background-color: #6a1b9a;
  }
</style>
</head>

<body>

<header>
  <h1>RAC√ì DE BITS: El dron que volia tocar el cel</h1>
  <p>Ajuda al dron a volar alt i no xocar-se amb cap n√∫vol!</p>
</header>

<div id="score">Puntuaci√≥: 0</div>
<div id="highScore">‚≠ê R√®cord: 0</div>
<div id="newRecord">üèÜ Nou r√®cord!</div>

<canvas id="gameCanvas" width="800" height="450"></canvas>
<button id="btnReiniciar" onclick="reiniciarJoc()">Reiniciar joc</button>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const droneImg = new Image();
  droneImg.src = 'https://i.imgur.com/8bGhlpo.png';

  const cloudImg = new Image();
  cloudImg.src = 'cloud.png';

  const drone = {
    x: 100,
    y: 200,
    width: 70,
    height: 50,
    dy: 0,
    gravity: 0.5,
    lift: -10,
    imgLoaded: false
  };

  droneImg.onload = () => {
    drone.imgLoaded = true;
  };

  let clouds = [];
  let cloudFrequency = 1400;
  let lastCloudTime = Date.now();

  let score = 0;
  let gameOver = false;

  let highScore = localStorage.getItem("highScore") || 0;
  document.getElementById("highScore").innerText = "‚≠ê R√®cord: " + highScore;

  function createCloud() {
    const height = 50 + Math.random() * 40;
    const y = Math.random() * (canvas.height - height);
    clouds.push({
      x: canvas.width,
      y: y,
      width: 100,
      height: height,
      speed: 3 + Math.random() * 2
    });
  }

  function drawDrone() {
    if(drone.imgLoaded) {
      ctx.drawImage(droneImg, drone.x, drone.y, drone.width, drone.height);
    }
  }

  function drawClouds() {
    clouds.forEach(cloud => {
      if(cloudImg.complete) {
        ctx.drawImage(cloudImg, cloud.x, cloud.y, cloud.width, cloud.height);
      }
    });
  }

  function moveClouds() {
    clouds.forEach(cloud => cloud.x -= cloud.speed);
    clouds = clouds.filter(cloud => cloud.x + cloud.width > 0);
  }

  function checkCollision() {
    for(let cloud of clouds) {
      if(drone.x < cloud.x + cloud.width &&
         drone.x + drone.width > cloud.x &&
         drone.y < cloud.y + cloud.height &&
         drone.y + drone.height > cloud.y) {
        gameOver = true;
      }
    }
  }

  function updateScore() {
    score++;
    document.getElementById('score').innerText = "Puntuaci√≥: " + score;

    if(score > highScore) {
      highScore = score;
      localStorage.setItem("highScore", highScore);
      document.getElementById("highScore").innerText = "‚≠ê R√®cord: " + highScore;
      document.getElementById("newRecord").style.display = "block";
    }
  }

  function update() {

    if(gameOver) {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#ffffff';
      ctx.font = '48px Poppins';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 20);

      ctx.font = '28px Poppins';
      ctx.fillText('Puntuaci√≥ final: ' + score, canvas.width/2, canvas.height/2 + 30);

      document.getElementById("btnReiniciar").style.display = "block";
      return;
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drone.dy += drone.gravity;
    drone.y += drone.dy;

    if(drone.y + drone.height > canvas.height) {
      drone.y = canvas.height - drone.height;
      drone.dy = 0;
    }

    if(drone.y < 0) {
      drone.y = 0;
      drone.dy = 0;
    }

    drawDrone();

    if(Date.now() - lastCloudTime > cloudFrequency) {
      createCloud();
      lastCloudTime = Date.now();
    }

    moveClouds();
    drawClouds();
    checkCollision();
    updateScore();

    requestAnimationFrame(update);
  }

  document.addEventListener('keydown', (e) => {
    if(e.code === 'ArrowUp' || e.code === 'Space') {
      drone.dy = drone.lift;
    }
  });

  function reiniciarJoc() {
    location.reload();
  }

  function waitImagesLoaded() {
    if(drone.imgLoaded && cloudImg.complete) {
      update();
    } else {
      setTimeout(waitImagesLoaded, 100);
    }
  }

  waitImagesLoaded();
</script>

</body>
</html>
